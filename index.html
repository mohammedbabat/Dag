<!-- =========================
FILE: index.html
========================= -->
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Willkommen in Dagestan</title>
  <meta name="description" content="Eine moderne, schnelle Ein-Seiten-Website: Willkommen in Dagestan ‚Äì Newsletter, Highlights und Downloads." />
  <meta property="og:title" content="Willkommen in Dagestan" />
  <meta property="og:description" content="Newsletter, Highlights und Downloads auf einer schlanken, responsiven Seite." />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#0f172a" />
  <style>
    :root{--bg:#0b1220;--bg-soft:#0f172a;--card:#111827;--muted:#94a3b8;--text:#e5e7eb;--brand:#22d3ee;--brand-2:#38bdf8;--ring:rgba(56,189,248,.45);--radius:16px;--shadow:0 10px 30px rgba(0,0,0,.35);--maxw:1200px;}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 600px at 80% -10%, rgba(34,211,238,.12), transparent), radial-gradient(800px 400px at 20% -20%, rgba(56,189,248,.10), transparent), var(--bg); color:var(--text); font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji"; -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;}
    a{color:inherit;text-decoration:none} img{max-width:100%;display:block}
    .container{width:min(100% - 2rem, var(--maxw)); margin-inline:auto}
    .btn{display:inline-flex;align-items:center;gap:.6rem;justify-content:center;padding:.9rem 1.1rem;border-radius:999px;font-weight:600;letter-spacing:.1px;background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#0b1220;box-shadow:0 8px 20px rgba(56,189,248,.35);border:none;cursor:pointer;transition:transform .15s, box-shadow .2s, filter .2s}
    .btn:hover{transform:translateY(-1px);filter:brightness(1.05);box-shadow:0 14px 30px rgba(56,189,248,.4)}
    .btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(148,163,184,.25);box-shadow:none}
    .btn.ghost:hover{border-color:rgba(148,163,184,.45)}
    .section{padding:64px 0}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); border:1px solid rgba(148,163,184,.18); border-radius:var(--radius); box-shadow:var(--shadow); backdrop-filter:blur(6px)}
    header{position:sticky;top:0;z-index:50; backdrop-filter:blur(10px); background:linear-gradient(180deg, rgba(11,18,32,.85), rgba(11,18,32,.55)); border-bottom:1px solid rgba(148,163,184,.18)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:.9rem 0}
    .brand{display:inline-flex;align-items:center;gap:.6rem;font-weight:800;letter-spacing:.2px}
    .brand-badge{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--brand),var(--brand-2));box-shadow:0 6px 16px rgba(56,189,248,.35)}
    .nav-links{display:none;gap:1rem} .nav a{color:var(--muted);font-weight:600} .nav a:hover{color:var(--text)}
    .burger{display:inline-flex;width:42px;height:42px;align-items:center;justify-content:center;border-radius:10px;border:1px solid rgba(148,163,184,.25);background:transparent;color:var(--text)}
    @media (min-width:920px){.nav-links{display:flex}.burger{display:none}}
    .hero{padding:88px 0 48px;position:relative;overflow:hidden}
    .hero-grid{display:grid;gap:28px;align-items:center;grid-template-columns:1.15fr .85fr}
    .eyebrow{color:var(--brand-2);font-weight:700;letter-spacing:.15em;text-transform:uppercase;font-size:.78rem}
    h1{font-size:clamp(2.2rem,4vw + .8rem,3.6rem);line-height:1.1;margin:.4rem 0 1rem}
    .lead{color:var(--muted);font-size:clamp(1rem, .65vw + .9rem, 1.125rem);max-width:60ch}
    .cta{display:flex;gap:.8rem;margin-top:1.3rem;flex-wrap:wrap}
    .hero-art{border-radius:22px;overflow:hidden;aspect-ratio:4/3;border:1px solid rgba(148,163,184,.18); background:radial-gradient(150% 100% at 80% 20%, rgba(34,211,238,.18), transparent 60%), radial-gradient(120% 100% at 10% 70%, rgba(56,189,248,.18), transparent 60%), linear-gradient(180deg, #0d1526, #0b1220 18%, #0b1220 90%); box-shadow:var(--shadow); display:grid;place-items:center;padding:1rem}
    .features{display:grid;gap:18px;grid-template-columns:repeat(12,1fr)} .feature{grid-column:span 12;padding:20px;display:grid;gap:12px;grid-template-columns:auto 1fr;align-items:start}
    .feature h3{margin:0;font-size:1.05rem} .icon{width:38px;height:38px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(135deg, rgba(34,211,238,.2), rgba(56,189,248,.2)); border:1px solid rgba(148,163,184,.25)}
    @media (min-width:720px){.feature{grid-column:span 6}} @media (min-width:1060px){.feature{grid-column:span 4}}
    .grid{display:grid;gap:16px} .grid.cols-3{grid-template-columns:repeat(1,1fr)} @media (min-width:780px){.grid.cols-3{grid-template-columns:repeat(2,1fr)}} @media (min-width:1100px){.grid.cols-3{grid-template-columns:repeat(3,1fr)}}
    .post{padding:16px;display:grid;gap:10px} .post h4{margin:0;font-size:1.05rem} .meta{color:var(--muted);font-size:.9rem} .post .actions{margin-top:.4rem;display:flex;gap:.6rem;flex-wrap:wrap}
    .downloads{display:grid;gap:12px} .dl-item{display:grid;gap:12px;grid-template-columns:44px 1fr auto;align-items:center;padding:12px} .dl-item:hover{background:rgba(255,255,255,.02);border-radius:12px}
    .badge{font-size:.8rem;padding:.2rem .6rem;border:1px solid rgba(148,163,184,.25);border-radius:999px;color:var(--muted)}
    footer{margin-top:36px;padding:24px 0 60px;color:var(--muted);border-top:1px solid rgba(148,163,184,.18)}
    .space-s{height:14px}
  </style>
</head>
<body>
  <header>
    <div class="container nav" role="navigation" aria-label="Hauptnavigation">
      <div class="brand"><div class="brand-badge" aria-hidden="true"></div><span>Dagestan</span></div>
      <nav class="nav-links" aria-label="Abschnittsnavigation">
        <a href="#about">√úber</a><a href="#newsletter">Newsletter</a><a href="#downloads">Downloads</a><a href="#kontakt">Kontakt</a>
      </nav>
      <a class="btn ghost" href="admin.html" aria-label="Zum Admin-Bereich">Admin</a>
      <button class="burger" id="menuBtn" aria-label="Men√º √∂ffnen" aria-expanded="false" aria-controls="mobileMenu">‚â°</button>
    </div>
  </header>

  <div id="mobileMenu" hidden class="container" style="padding:0 0 12px;">
    <div class="card" style="padding:12px;display:grid;gap:8px;">
      <a href="#about">√úber</a><a href="#newsletter">Newsletter</a><a href="#downloads">Downloads</a><a href="#kontakt">Kontakt</a>
      <a href="admin.html">Admin</a>
    </div>
  </div>

  <section class="hero">
    <div class="container hero-grid">
      <div>
        <div class="eyebrow">Willkommen</div>
        <h1>Willkommen in Dagestan</h1>
        <p class="lead">Eine moderne, schnelle Seite √ºber Natur, Kultur und Menschen ‚Äì mit aktuellen Newslettern und einem praktischen Download-Bereich.</p>
        <div class="cta">
          <a class="btn" href="#newsletter">Newsletter lesen</a>
          <a class="btn ghost" href="#downloads">Downloads</a>
        </div>
      </div>
      <div class="hero-art card" aria-hidden="true">
        <svg viewBox="0 0 600 450" width="100%" height="100%" role="img" aria-label="Abstrakte Landschaft">
          <defs><linearGradient id="g1" x1="0" x2="1" y1="0" y2="1"><stop offset="0%" stop-color="#22d3ee" stop-opacity=".85"/><stop offset="100%" stop-color="#38bdf8" stop-opacity=".85"/></linearGradient></defs>
          <rect x="0" y="0" width="600" height="450" fill="url(#g1)" opacity=".08"/>
          <g opacity=".9"><path d="M0 340 C120 300, 220 320, 320 300 C420 280, 520 300, 600 260 L600 450 L0 450 Z" fill="#38bdf8" opacity=".25"/>
          <path d="M0 320 C120 280, 220 290, 320 270 C420 250, 520 260, 600 220 L600 450 L0 450 Z" fill="#22d3ee" opacity=".25"/><circle cx="470" cy="120" r="55" fill="#fff" opacity=".85"/></g>
        </svg>
      </div>
    </div>
  </section>

  <section id="about" class="section"><div class="container">
    <h2>√úber Dagestan</h2>
    <p class="lead">Zwischen Kaspischem Meer und Kaukasus: vielf√§ltige Landschaften, Sprachen und Traditionen.</p>
    <div class="space-s"></div>
    <div class="features">
      <div class="feature card"><div class="icon">üèîÔ∏è</div><div><h3>Natur & Berge</h3><p class="meta">Schluchten, alpine P√§sse und weite Steppen.</p></div></div>
      <div class="feature card"><div class="icon">üèõÔ∏è</div><div><h3>Kultur & Geschichte</h3><p class="meta">Vielsprachige Traditionen und Handwerk.</p></div></div>
      <div class="feature card"><div class="icon">üçΩÔ∏è</div><div><h3>Kulinarik</h3><p class="meta">Herzhafte K√ºche des Kaukasus.</p></div></div>
    </div>
  </div></section>

  <section id="newsletter" class="section" aria-labelledby="newsletter-heading">
    <div class="container">
      <h2 id="newsletter-heading">Newsletter</h2>
      <p class="lead">Hier ver√∂ffentlichst du deine aktuellen Ausgaben.</p>
      <div class="grid cols-3">
        <article class="post card"><div class="meta">Ausgabe ‚Ä¢ September 2025</div><h4>ÿßŸÑÿ™ÿ¨ŸÖÿπ ÿßŸÑÿ≥ŸÜŸàŸä</h4><p>ŸÖŸÜ ŸäŸàŸÖ Ÿ¢Ÿß/Ÿ†Ÿß/Ÿ¢Ÿ†Ÿ¢Ÿ¶</p><p>ÿßŸÑŸâooooooo ŸäŸàŸÖ Ÿ†Ÿ°/Ÿ†Ÿ®/Ÿ¢Ÿ†Ÿ¢Ÿ¶</p><div class="actions"><a href="#" class="btn">Lesen</a><a href="/downloads/newsletter-2025-09.pdf" class="btn ghost" download>PDF herunterladen</a></div></article>
        <article class="post card"><div class="meta">Ausgabe ‚Ä¢ August 2025</div><h4>Sommer am Kaspischen Meer</h4><p>Str√§nde, Veranstaltungen und praktische Tipps.</p><div class="actions"><a href="#" class="btn">Lesen</a><a href="/downloads/newsletter-2025-08.pdf" class="btn ghost" download>PDF herunterladen</a></div></article>
        <article class="post card"><div class="meta">Ausgabe ‚Ä¢ Juli 2025</div><h4>Traditionen & Feste</h4><p>Einblicke in lokale Br√§uche.</p><div class="actions"><a href="#" class="btn">Lesen</a><a href="/downloads/newsletter-2025-07.pdf" class="btn ghost" download>PDF herunterladen</a></div></article>
      </div>

      <div class="subscribe card" role="region" aria-labelledby="abo-title">
        <h3 id="abo-title" style="margin:0;">Newsletter abonnieren</h3>
        <p class="meta">E-Mail eintragen (FormSubmit).</p>
        <form method="post" action="https://formsubmit.co/mohammed-bbaat@hotmail.com">
          <label for="email" class="meta">E-Mail-Adresse</label>
          <div style="display:flex;gap:8px;align-items:center;">
            <input class="input" id="email" name="email" type="email" placeholder="name@beispiel.de" required/>
            <button class="btn" type="submit">Abonnieren</button>
          </div>
          <input type="hidden" name="_captcha" value="false">
          <input type="hidden" name="_subject" value="Neues Newsletter-Abo (Dagestan)">
          <input type="hidden" name="_template" value="box">
        </form>
      </div>
    </div>
  </section>

  <section id="downloads" class="section" aria-labelledby="downloads-heading">
    <div class="container">
      <h2 id="downloads-heading">Downloads</h2>
      <p class="lead">Lege deine Dateien im Ordner <code>/downloads</code> im Repo ab oder nutze Dropbox-Links.</p>
      <div class="card" style="padding:12px;">
        <div class="downloads" role="list">
          <div class="dl-item" role="listitem"><div class="icon">üìÑ</div><div><div><strong>Newsletter September 2025 (PDF)</strong></div><div class="meta">ca. 2,3 MB</div></div><a class="btn ghost" href="/downloads/newsletter-2025-09.pdf" download>Herunterladen</a></div>
          <div class="dl-item" role="listitem"><div class="icon">üìÅ</div><div><div><strong>Pressebilder Paket (ZIP)</strong></div><div class="meta">10 Bilder ‚Ä¢ ca. 12 MB</div></div><a class="btn ghost" href="/downloads/pressebilder-dagestan.zip" download>Herunterladen</a></div>
          <div class="dl-item" role="listitem"><div class="icon">üìù</div><div><div><strong>Reise-Checkliste (DOCX)</strong></div><div class="meta">Vorlage ‚Ä¢ 1 Seite</div></div><a class="btn ghost" href="/downloads/reise-checkliste.docx" download>Herunterladen</a></div>
        </div>
      </div>
    </div>
  </section>

  <section id="kontakt" class="section"><div class="container">
    <h2>Kontakt</h2>
    <p class="lead">Nachrichten gehen an <strong>mohammed-bbaat@hotmail.com</strong>.</p>
    <div class="card" style="padding:16px;">
      <form method="post" action="https://formsubmit.co/mohammed-bbaat@hotmail.com" aria-label="Kontaktformular">
        <div class="grid" style="grid-template-columns:1fr 1fr;gap:12px;">
          <div><label class="meta" for="name">Name</label><input class="input" id="name" name="name" required/></div>
          <div><label class="meta" for="mail">E-Mail</label><input class="input" id="mail" name="email" type="email" required/></div>
        </div>
        <div class="space-s"></div>
        <div><label class="meta" for="msg">Nachricht</label><textarea class="input" id="msg" name="message" rows="5" required></textarea></div>
        <div class="space-s"></div>
        <input type="hidden" name="_captcha" value="false"><input type="hidden" name="_subject" value="Neue Nachricht √ºber die Webseite (Dagestan)"><input type="hidden" name="_template" value="box">
        <button class="btn" type="submit">Senden</button>
      </form>
    </div>
  </div></section>

  <footer>
    <div class="container" style="display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;">
      <div>¬© <span id="year"></span> Dagestan ‚Äì Alle Rechte vorbehalten.</div>
      <div style="display:flex;gap:12px;"><a class="badge" href="#">Impressum</a><a class="badge" href="#">Datenschutz</a></div>
    </div>
  </footer>

  <script>
    const menuBtn=document.getElementById('menuBtn'); const mobileMenu=document.getElementById('mobileMenu');
    menuBtn?.addEventListener('click',()=>{const open=!mobileMenu.hasAttribute('hidden'); if(open){mobileMenu.setAttribute('hidden','')}else{mobileMenu.removeAttribute('hidden')} menuBtn.setAttribute('aria-expanded', String(!open));});
    document.getElementById('year').textContent=new Date().getFullYear();
  </script>

  <!-- Auth-Gate: Seite nur anzeigen, wenn eingeloggt -->
  <!-- (auth.js enth√§lt wieder deine Firebase Config) -->
  <script type="module" src="auth.js"></script>
</body>
</html>


<!-- =========================
FILE: admin.html
========================= -->
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin ‚Äì Dagestan</title>
  <meta name="theme-color" content="#0f172a" />
  <style>
    :root{--bg:#0b1220;--card:#111827;--text:#e5e7eb;--muted:#94a3b8;--brand:#22d3ee;--brand-2:#38bdf8;--ring:rgba(56,189,248,.45);--radius:16px;--shadow:0 10px 30px rgba(0,0,0,.35);--maxw:720px;}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto}
    .container{width:min(100% - 2rem, var(--maxw));margin:40px auto}
    h1{margin:0 0 6px} .lead{color:var(--muted);margin:0 0 16px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); border:1px solid rgba(148,163,184,.18); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px}
    .input{width:100%;padding:.9rem 1rem;border-radius:12px;border:1px solid rgba(148,163,184,.25);background:rgba(255,255,255,.02);color:var(--text);outline:none;box-shadow:0 0 0 0 var(--ring)}
    .input:focus{box-shadow:0 0 0 6px var(--ring);border-color:rgba(56,189,248,.55)}
    .btn{display:inline-flex;align-items:center;gap:.6rem;justify-content:center;padding:.9rem 1.1rem;border-radius:999px;font-weight:600;background:linear-gradient(135deg,var(--brand),var(--brand-2));color:#0b1220;border:none;cursor:pointer}
    .row{display:grid;gap:10px;grid-template-columns:1fr} .meta{color:var(--muted);font-size:.9rem}
    a{color:inherit;text-decoration:none}
  </style>
</head>
<body>
  <div class="container">
    <h1>Admin</h1>
    <p class="lead">Lade Dateien ins GitHub-Repo (Ordner <code>/downloads</code>). Passwort erforderlich.</p>

    <div class="card" style="margin-bottom:12px;">
      <label class="meta" for="pw">Admin-Passwort</label>
      <input id="pw" class="input" type="password" placeholder="Password90AZ" />
      <div style="height:8px"></div>
      <button class="btn" id="unlock">Freischalten</button>
      <div id="pwinfo" class="meta" style="margin-top:8px;">Tipp: Passwort lautet <code>Password90AZ</code> (sp√§ter in der Function als ENV sichern).</div>
    </div>

    <div id="uploader" class="card" hidden>
      <div class="row">
        <div>
          <label class="meta" for="file">Datei</label>
          <input class="input" id="file" type="file" />
        </div>
        <div>
          <label class="meta" for="subpath">Unterordner (optional)</label>
          <input class="input" id="subpath" placeholder="z.B. 2025/" />
        </div>
        <div>
          <label class="meta" for="branch">Branch</label>
          <input class="input" id="branch" value="main" />
        </div>
        <div>
          <label class="meta" for="message">Commit-Nachricht</label>
          <input class="input" id="message" value="Add file via admin" />
        </div>
      </div>
      <div style="height:8px"></div>
      <button class="btn" id="uploadBtn">Hochladen</button>
      <div id="status" class="meta" style="margin-top:10px;"></div>
    </div>

    <div class="card" style="margin-top:12px;">
      <a class="btn" href="index.html">‚Üê Zur√ºck zur Website</a>
    </div>
  </div>

  <script>
    const unlockBtn = document.getElementById('unlock');
    const uploader = document.getElementById('uploader');
    const statusEl = document.getElementById('status');
    unlockBtn.addEventListener('click', ()=>{
      const ok = document.getElementById('pw').value === 'Password90AZ';
      uploader.hidden = !ok;
      statusEl.textContent = ok ? 'Freigeschaltet.' : 'Falsches Passwort.';
    });

    document.getElementById('uploadBtn').addEventListener('click', async ()=>{
      const fileInput = document.getElementById('file');
      const subpath = (document.getElementById('subpath').value || '').trim();
      const branch = (document.getElementById('branch').value || 'main').trim();
      const message = (document.getElementById('message').value || 'Add file via admin').trim();
      const file = fileInput.files?.[0];
      if(!file){ statusEl.textContent='Bitte Datei ausw√§hlen.'; return; }

      statusEl.textContent='Lade hoch‚Ä¶';
      try{
        const body = new FormData();
        body.append('file', file);
        body.append('branch', branch);
        body.append('message', message);
        body.append('subpath', subpath);

        const res = await fetch('/api/upload', {
          method: 'POST',
          headers: { 'x-admin-password': document.getElementById('pw').value },
          body
        });
        if(!res.ok){ throw new Error(await res.text()); }
        const data = await res.json();
        statusEl.innerHTML = `‚úîÔ∏è Hochgeladen: <a href="${data.html_url}" target="_blank" rel="noopener">${data.path}</a>`;
        fileInput.value = '';
      }catch(e){
        statusEl.textContent = '‚ùå ' + (e.message || e);
      }
    });
  </script>
</body>
</html>

<!-- =========================
FILE: api/upload.js  (Vercel Serverless Function)
- Lege diese Datei im Verzeichnis /api ab.
- Setze ENV: GITHUB_TOKEN (Fine-grained PAT mit repo content), ADMIN_PASSWORD=Password90AZ
- Konfig: OWNER, REPO, BASE_DIR und optional DEFAULT_BRANCH
========================= -->
/** @type {(req: import('http').IncomingMessage & {method:string, headers:Record<string,string>, query?:any}, res: import('http').ServerResponse & {status:(n:number)=>any, setHeader:(k:string,v:string)=>any, end:(b?:any)=>any}) => any} */
export default async function handler(req, res) {
  // CORS (optional, hilfreich lokal)
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'POST, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type, x-admin-password');
  if (req.method === 'OPTIONS') { res.statusCode = 204; return res.end(); }
  if (req.method !== 'POST') { res.statusCode = 405; return res.end('Method Not Allowed'); }

  try {
    // ---- Konfiguration ----
    const OWNER = 'DEIN_GITHUB_USERNAME';     // <‚Äî anpassen
    const REPO  = 'DEIN_REPO_NAME';           // <‚Äî anpassen
    const BASE_DIR = 'downloads';              // Zielordner im Repo
    const DEFAULT_BRANCH = 'main';

    const ADMIN_PASSWORD = process.env.ADMIN_PASSWORD || '';
    const TOKEN = process.env.GITHUB_TOKEN || '';
    if (!TOKEN) { res.statusCode = 500; return res.end('Server misconfigured: missing GITHUB_TOKEN'); }

    // ---- Passwort pr√ºfen ----
    const pass = req.headers['x-admin-password'] || '';
    if (pass !== ADMIN_PASSWORD) { res.statusCode = 401; return res.end('Unauthorized'); }

    // ---- FormData parsen ----
    // Vercel bietet kein automatisches FormData-Parsing; wir lesen den Stream und nutzen 'busboy' nicht,
    // sondern einen kleinen Workaround f√ºr einzelne Datei-Uploads mit und ohne gro√üen Umfang:
    // F√ºr Einfachheit nehmen wir 'formidable' NICHT, stattdessen holen wir den Body als Buffer und extrahieren per boundary.
    // -> F√ºr robuste Produktion: 'busboy' verwenden. Hier: simpler Parser.

    const chunks = [];
    for await (const chunk of req) chunks.push(chunk);
    const raw = Buffer.concat(chunks);
    const ctype = req.headers['content-type'] || '';
    const boundaryMatch = ctype.match(/boundary=(.*)$/);
    if (!boundaryMatch) { res.statusCode = 400; return res.end('Bad Request: no multipart boundary'); }
    const boundary = '--' + boundaryMatch[1];

    // sehr einfacher Multipart-Parser (eine Datei + ein paar Textfelder)
    const parts = raw.toString('binary').split(boundary).slice(1, -1);
    let branch = DEFAULT_BRANCH, message = 'Add file via admin', subpath = '';
    /** @type {{filename:string, data:Buffer, contentType:string}|null} */
    let filePart = null;

    for (const p of parts) {
      const [rawHeaders, rawBody] = p.split('\r\n\r\n');
      if (!rawBody) continue;
      const bodyContent = rawBody.slice(0, -2); // drop trailing \r\n
      const nameMatch = rawHeaders.match(/name="([^"]+)"/);
      if (!nameMatch) continue;
      const name = nameMatch[1];

      const filenameMatch = rawHeaders.match(/filename="([^"]+)"/);
      if (filenameMatch) {
        const filename = filenameMatch[1];
        const ctMatch = rawHeaders.match(/Content-Type:\s*([^\r\n]+)/i);
        const contentType = ctMatch ? ctMatch[1] : 'application/octet-stream';
        const buf = Buffer.from(bodyContent, 'binary');
        filePart = { filename, data: buf, contentType };
      } else {
        const value = bodyContent.toString('utf8');
        if (name === 'branch') branch = value || DEFAULT_BRANCH;
        if (name === 'message') message = value || message;
        if (name === 'subpath') subpath = value || '';
      }
    }

    if (!filePart) { res.statusCode = 400; return res.end('No file'); }

    // ---- Zielpfad bauen ----
    const cleanSub = (subpath || '').replace(/^\/+|\/+$/g, '');
    const path = cleanSub ? `${BASE_DIR}/${cleanSub}/${filePart.filename}` : `${BASE_DIR}/${filePart.filename}`;

    // ---- Pr√ºfen, ob Datei existiert (f√ºr sha) ----
    const baseUrl = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${encodeURIComponent(path).replace(/%2F/g,'/')}`;
    let sha = undefined;
    const head = await fetch(`${baseUrl}?ref=${encodeURIComponent(branch)}`, { headers: { Authorization: `Bearer ${TOKEN}`, 'User-Agent': 'upload-fn' }});
    if (head.ok) {
      const js = await head.json();
      sha = js.sha;
    }

    // ---- Datei hochladen (create/update) ----
    const contentB64 = filePart.data.toString('base64');
    const putRes = await fetch(baseUrl, {
      method: 'PUT',
      headers: {
        Authorization: `Bearer ${TOKEN}`,
        'User-Agent': 'upload-fn',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message,
        content: contentB64,
        branch,
        sha
      })
    });

    if (!putRes.ok) {
      const t = await putRes.text();
      res.statusCode = putRes.status;
      return res.end(`GitHub error: ${t}`);
    }

    const result = await putRes.json();
    res.setHeader('Content-Type', 'application/json');
    res.statusCode = 200;
    return res.end(JSON.stringify({ path, html_url: result.content.html_url }));
  } catch (e) {
    res.statusCode = 500;
    return res.end('Server error: ' + (e?.message || String(e)));
  }
}

/* =========================
ALTERNATIVE: Netlify Function (kommentiert)
- Datei: netlify/functions/upload.js
- netlify.toml:
[functions]
  node_bundler = "esbuild"
[[redirects]]
  from = "/api/upload"
  to = "/.netlify/functions/upload"
  status = 200

// Inhalt (gleiches Prinzip wie oben, aber mit Netlify Handler):
// exports.handler = async (event) => { ... }  -> mit multipart parser (busboy) empfohlen
========================= */
